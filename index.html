<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªô Tr√¨nh T∆∞∆°ng T√°c H·ªçc Ti·∫øng Anh Giao Ti·∫øp (v·ªõi Gemini AI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony (Warm Neutrals with Teal Accent) -->
    <!-- Application Structure Plan: The application uses a single-page, section-based architecture with a sticky top navigation bar. This design transforms the linear report into a user-driven, interactive tool. Users can either follow a logical learning path (Foundation -> Practice -> AI Sandbox -> Roadmap) or use the navigation to jump directly to a specific topic for quick reference. The new "AI Sandbox" section allows for freeform, user-driven content generation, making the app a highly personalized learning partner. -->
    <!-- Visualization & Content Choices:
    - Report Info: Importance of 5 key tenses (Present Perfect is 60-70%). Goal: Compare, Inform. Viz: Doughnut Chart (Chart.js). Interaction: Hover to see percentages. Justification: Visually emphasizes the 80/20 principle of focusing on high-impact grammar.
    - Report Info: Thematic Vocabulary Lists. Goal: Organize, Explore. Viz: Filterable card grid (HTML/CSS/JS). Interaction: Select a theme; click a button on a word card to call Gemini API for example sentences displayed in a modal. Justification: Provides contextual, on-demand learning.
    - Report Info: Communication Practice. Goal: Practice, Feedback. Viz: Interactive AI Arena (HTML/CSS/JS). Interaction: User gets an AI-generated scenario, writes a response, and gets detailed AI feedback. Justification: Creates an endlessly replayable, personalized practice loop.
    - NEW FEATURE: AI Sandbox. Goal: Explore, Create. Viz: Text input and output areas. Interaction: User types a freeform request, and Gemini API generates custom content (dialogues, examples, explanations). Justification: This provides ultimate flexibility and turns the tool into a creative learning partner, addressing any specific learning need the user has on the spot.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 40vh;
            width: 80vw;
            max-width: 450px;
            max-height: 450px;
        }
        .tab-button.active {
            border-color: #0d9488;
            background-color: #ccfbf1;
            color: #0d9488;
            font-weight: 600;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .accordion-button.open .accordion-arrow {
            transform: rotate(180deg);
        }
        .nav-link.active {
            color: #0d9488;
            font-weight: 700;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0d9488;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .pyramid-level {
            padding: 0.5rem;
            color: white;
            text-align: center;
            font-weight: 600;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <h1 class="text-xl md:text-2xl font-bold text-teal-700">L√†m ch·ªß Ti·∫øng Anh Giao ti·∫øp</h1>
                <nav class="hidden md:flex space-x-6">
                    <a href="#foundation" class="nav-link text-stone-600 hover:text-teal-600 transition">N·ªÅn t·∫£ng</a>
                    <a href="#practice" class="nav-link text-stone-600 hover:text-teal-600 transition">Th·ª±c h√†nh</a>
                    <a href="#ai-sandbox" class="nav-link text-stone-600 hover:text-teal-600 transition">H·ªôp c√°t AI</a>
                    <a href="#roadmap" class="nav-link text-stone-600 hover:text-teal-600 transition">L·ªô tr√¨nh</a>
                    <a href="#resources" class="nav-link text-stone-600 hover:text-teal-600 transition">T√†i nguy√™n</a>
                </nav>
                <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-stone-600 hover:bg-teal-50 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-stone-200">
            <a href="#foundation" class="block py-2 px-4 text-sm text-stone-600 hover:bg-teal-50">N·ªÅn t·∫£ng</a>
            <a href="#practice" class="block py-2 px-4 text-sm text-stone-600 hover:bg-teal-50">Th·ª±c h√†nh</a>
            <a href="#ai-sandbox" class="block py-2 px-4 text-sm text-stone-600 hover:bg-teal-50">H·ªôp c√°t AI</a>
            <a href="#roadmap" class="block py-2 px-4 text-sm text-stone-600 hover:bg-teal-50">L·ªô tr√¨nh</a>
            <a href="#resources" class="block py-2 px-4 text-sm text-stone-600 hover:bg-teal-50">T√†i nguy√™n</a>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <section id="intro" class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold text-stone-800 mb-4">Con ƒë∆∞·ªùng ƒë·∫øn s·ª± tr√¥i ch·∫£y b·∫Øt ƒë·∫ßu t·ª´ ƒë√¢y</h2>
            <p class="max-w-3xl mx-auto text-stone-600">
                Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi l·ªô tr√¨nh h·ªçc ti·∫øng Anh giao ti·∫øp t∆∞∆°ng t√°c, nay ƒë√£ ƒë∆∞·ª£c t√≠ch h·ª£p AI. H√£y kh√°m ph√° c√°c n·ªÅn t·∫£ng c·ªët l√µi, th·ª±c h√†nh v·ªõi AI v√† ƒëi theo m·ªôt l·ªô tr√¨nh r√µ r√†ng ƒë·ªÉ chinh ph·ª•c ti·∫øng Anh.
            </p>
        </section>

        <section id="foundation" class="mb-16 scroll-mt-20">
             <h2 class="text-2xl md:text-3xl font-bold text-teal-700 mb-2">Ph·∫ßn 1: N·ªÅn t·∫£ng C·ªët l√µi</h2>
            <p class="text-stone-600 mb-8">ƒê√¢y l√† n∆°i x√¢y d·ª±ng n·ªÅn m√≥ng v·ªØng ch·∫Øc cho kh·∫£ nƒÉng giao ti·∫øp. Ch√∫ng t√¥i t·∫≠p trung v√†o 20% ki·∫øn th·ª©c t·∫°o ra 80% hi·ªáu qu·∫£. H√£y t∆∞∆°ng t√°c v·ªõi c√°c c√¥ng c·ª• d∆∞·ªõi ƒë√¢y ƒë·ªÉ n·∫Øm v·ªØng nh·ªØng y·∫øu t·ªë quan tr·ªçng nh·∫•t, nay c√≥ th√™m s·ª± tr·ª£ gi√∫p t·ª´ AI.</p>

            <div class="grid md:grid-cols-5 gap-8">
                <div class="md:col-span-3 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Ng·ªØ ph√°p Tr·ªçng t√¢m (80/20)</h3>
                    
                    <div id="grammar-tabs-container">
                        <div class="border-b border-stone-200 mb-4">
                            <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                                <button data-tab="tenses" class="tab-button active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">5 Th√¨ C·ªët l√µi</button>
                                <button data-tab="modals" class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">ƒê·ªông t·ª´ Khi·∫øm khuy·∫øt</button>
                                <button data-tab="prepositions" class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Gi·ªõi t·ª´ IN/ON/AT</button>
                            </nav>
                        </div>
                        <div id="tenses-content" class="tab-content">
                             <div id="tenses-accordion"></div>
                        </div>
                        <div id="modals-content" class="tab-content hidden">
                            <div id="modals-accordion"></div>
                        </div>
                        <div id="prepositions-content" class="tab-content hidden">
                            <p class="text-sm text-stone-600 mb-4">S·ª≠ d·ª•ng m√¥ h√¨nh kim t·ª± th√°p ng∆∞·ª£c ƒë·ªÉ ghi nh·ªõ: ƒëi t·ª´ t·ªïng qu√°t (IN) ƒë·∫øn c·ª• th·ªÉ (ON) v√† ch√≠nh x√°c nh·∫•t (AT).</p>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div id="time-pyramid"></div>
                                <div id="place-pyramid"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">T·∫ßm quan tr·ªçng c√°c Th√¨</h3>
                    <p class="text-sm text-stone-600 mb-4">Bi·ªÉu ƒë·ªì n√†y minh h·ªça t·∫ßn su·∫•t s·ª≠ d·ª•ng t∆∞∆°ng ƒë·ªëi c·ªßa c√°c th√¨ trong giao ti·∫øp h√†ng ng√†y. ƒêi·ªÅu n√†y l√Ω gi·∫£i t·∫°i sao vi·ªác t·∫≠p trung v√†o 5 th√¨ c·ªët l√µi l·∫°i hi·ªáu qu·∫£ ƒë·∫øn v·∫≠y.</p>
                    <div class="chart-container">
                        <canvas id="tensesChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="mt-8 bg-white p-6 rounded-xl shadow-sm">
                <h3 class="text-xl font-bold mb-4">X√¢y d·ª±ng V·ªën t·ª´ v·ª±ng Chi·∫øn l∆∞·ª£c</h3>
                <p class="text-sm text-stone-600 mb-6">H·ªçc t·ª´ v·ª±ng theo ch·ªß ƒë·ªÅ gi√∫p b·∫°n √°p d·ª•ng ngay v√†o c√°c cu·ªôc h·ªôi tho·∫°i quen thu·ªôc. H√£y ch·ªçn m·ªôt ch·ªß ƒë·ªÅ, sau ƒë√≥ nh·∫•p v√†o n√∫t ‚ú® ƒë·ªÉ AI t·∫°o c√¢u v√≠ d·ª• cho b·∫°n!</p>
                <div class="mb-4">
                    <select id="vocab-theme-selector" class="w-full md:w-1/3 p-2 border border-stone-300 rounded-md bg-white focus:ring-teal-500 focus:border-teal-500">
                    </select>
                </div>
                <div id="vocab-display" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                </div>
            </div>
        </section>

        <section id="practice" class="mb-16 scroll-mt-20">
            <h2 class="text-2xl md:text-3xl font-bold text-teal-700 mb-2">Ph·∫ßn 2: T·ª´ L√Ω thuy·∫øt ƒë·∫øn Th·ª±c chi·∫øn</h2>
             <p class="text-stone-600 mb-8">Ki·∫øn th·ª©c ch·ªâ th·ª±c s·ª± h·ªØu √≠ch khi ƒë∆∞·ª£c √°p d·ª•ng. Ph·∫ßn n√†y cung c·∫•p c√°c c√¥ng c·ª• v√† m·∫´u c√¢u ƒë·ªÉ b·∫°n bi·∫øn ng·ªØ ph√°p v√† t·ª´ v·ª±ng th√†nh l·ªùi n√≥i t·ª± nhi√™n trong c√°c t√¨nh hu·ªëng th·ª±c t·∫ø. H√£y kh√°m ph√° b·ªô c√¥ng c·ª• giao ti·∫øp ƒëa d·∫°ng c·ªßa ch√∫ng t√¥i.</p>
            
            <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                <h3 class="text-xl font-bold mb-4">B·ªô C√¥ng c·ª• Giao ti·∫øp theo T√¨nh hu·ªëng</h3>
                <div id="practice-tabs-container">
                    <div class="border-b border-stone-200 mb-4">
                        <nav class="-mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
                            <button data-tab="requests" class="tab-button active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Y√™u c·∫ßu & ƒê·ªÅ ngh·ªã</button>
                            <button data-tab="advice" class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Cho L·ªùi khuy√™n</button>
                            <button data-tab="opinions" class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">B√†y t·ªè Quan ƒëi·ªÉm</button>
                        </nav>
                    </div>
                    <div id="requests-content" class="tab-content"></div>
                    <div id="advice-content" class="tab-content hidden"></div>
                    <div id="opinions-content" class="tab-content hidden"></div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-teal-50 to-emerald-50 p-6 rounded-xl shadow-sm border border-teal-100">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2"><span class="text-2xl">‚ú®</span> S√¢n Ch∆°i Luy·ªán T·∫≠p AI</h3>
                <p class="text-sm text-stone-600 mb-4">S·∫µn s√†ng th·ª±c h√†nh? Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ AI t·∫°o m·ªôt t√¨nh hu·ªëng giao ti·∫øp. Vi·∫øt c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n v√† nh·∫≠n ph·∫£n h·ªìi t·ª©c th√¨!</p>
                <button id="generate-scenario-btn" class="mb-4 inline-flex items-center gap-2 bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 transition shadow">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v1.126a9.002 9.002 0 015.122 5.122H18a1 1 0 01.954.88l.035.116a1 1 0 01-1.88.168L17 10h-1.126a9.002 9.002 0 01-5.122-5.122V4a1 1 0 01-.88-.954L9.842 3A1 1 0 0111.17 1.76l.13.016zM10 4.874A6.002 6.002 0 004.874 10H4a1 1 0 100 2h.874A6.002 6.002 0 0010 17.126V18a1 1 0 102 0v-.874A6.002 6.002 0 0017.126 12H18a1 1 0 100-2h-.874A6.002 6.002 0 0012 4.874L11.874 5H12a5 5 0 015 5v.126A6.002 6.002 0 0012.126 15H12a5 5 0 01-5-5v-.126A6.002 6.002 0 0011.874 5H12v-.126z" clip-rule="evenodd" /></svg>
                    T·∫°o t√¨nh hu·ªëng m·ªõi
                </button>
                
                <div id="ai-practice-area" class="space-y-4">
                    <div id="scenario-display" class="p-4 bg-white rounded-md border border-stone-200 min-h-[60px] text-stone-700 italic">Nh·∫•n n√∫t tr√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu...</div>
                    <textarea id="user-response-input" class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" rows="3" placeholder="Vi·∫øt c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n ·ªü ƒë√¢y..."></textarea>
                    <button id="get-feedback-btn" class="bg-teal-800 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-900 transition shadow disabled:bg-gray-400 disabled:cursor-not-allowed">‚ú® Nh·∫≠n ph·∫£n h·ªìi t·ª´ AI</button>
                    <div id="feedback-display" class="p-4 bg-white rounded-md border border-stone-200 min-h-[60px] text-stone-700 hidden"></div>
                </div>

            </div>
        </section>

        <section id="ai-sandbox" class="mb-16 scroll-mt-20">
            <h2 class="text-2xl md:text-3xl font-bold text-teal-700 mb-2">Ph·∫ßn 3: H·ªôp c√°t S√°ng t·∫°o v·ªõi AI</h2>
            <p class="text-stone-600 mb-8">ƒê√¢y l√† kh√¥ng gian t·ª± do ƒë·ªÉ b·∫°n kh√°m ph√°. H√£y y√™u c·∫ßu AI t·∫°o ra b·∫•t c·ª© ƒëi·ªÅu g√¨ b·∫°n c·∫ßn ƒë·ªÉ h·ªçc: m·ªôt ƒëo·∫°n h·ªôi tho·∫°i, c√°c c√¢u v√≠ d·ª• cho m·ªôt c·∫•u tr√∫c ng·ªØ ph√°p, ho·∫∑c th·∫≠m ch√≠ l√† m·ªôt email m·∫´u. H√£y s√°ng t·∫°o nh√©!</p>
            <div class="bg-white p-6 rounded-xl shadow-sm">
                <div class="space-y-4">
                    <label for="ai-request-input" class="block font-semibold text-stone-700">Nh·∫≠p y√™u c·∫ßu c·ªßa b·∫°n t·∫°i ƒë√¢y:</label>
                    <textarea id="ai-request-input" class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" rows="4" placeholder="V√≠ d·ª•: t·∫°o m·ªôt ƒëo·∫°n h·ªôi tho·∫°i ng·∫Øn v·ªÅ vi·ªác ƒë·∫∑t ph√≤ng kh√°ch s·∫°n qua ƒëi·ªán tho·∫°i, k√®m gi·∫£i th√≠ch c√°c c·ª•m t·ª´ quan tr·ªçng."></textarea>
                    <button id="generate-custom-btn" class="bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 transition shadow inline-flex items-center gap-2">üöÄ T·∫°o n·ªôi dung</button>
                    <div id="custom-output-display" class="p-4 mt-4 bg-stone-50 rounded-md border border-stone-200 min-h-[100px] text-stone-800">K·∫øt qu·∫£ s·∫Ω hi·ªán ·ªü ƒë√¢y...</div>
                </div>
            </div>
        </section>

        <section id="roadmap" class="mb-16 scroll-mt-20">
            <h2 class="text-2xl md:text-3xl font-bold text-teal-700 mb-2">Ph·∫ßn 4: L·ªô tr√¨nh v√† Ph∆∞∆°ng ph√°p Luy·ªán t·∫≠p</h2>
            <p class="text-stone-600 mb-8">S·ª± tr√¥i ch·∫£y l√† k·∫øt qu·∫£ c·ªßa luy·ªán t·∫≠p ki√™n tr√¨ v√† c√≥ ph∆∞∆°ng ph√°p. T·∫°i ƒë√¢y, b·∫°n s·∫Ω t√¨m th·∫•y m·ªôt l·ªô tr√¨nh 12 tu·∫ßn chi ti·∫øt v√† c√°c k·ªπ thu·∫≠t luy·ªán t·∫≠p chuy√™n s√¢u ƒë·ªÉ bi·∫øn k·ªπ nƒÉng th√†nh ph·∫£n x·∫° t·ª± nhi√™n. H√£y kh√°m ph√° t·ª´ng tu·∫ßn ƒë·ªÉ th·∫•y s·ª± ti·∫øn b·ªô c·ªßa m√¨nh.</p>

            <div class="bg-white p-6 rounded-xl shadow-sm">
                <h3 class="text-xl font-bold mb-4">L·ªô tr√¨nh T·ª± h·ªçc trong 12 Tu·∫ßn</h3>
                <div id="roadmap-accordion" class="space-y-2"></div>
            </div>
             <div class="mt-8 bg-white p-6 rounded-xl shadow-sm">
                <h3 class="text-xl font-bold mb-4">C√°c K·ªπ thu·∫≠t Luy·ªán t·∫≠p Chuy√™n s√¢u</h3>
                <div id="techniques-accordion" class="space-y-2"></div>
            </div>
        </section>

        <section id="resources" class="scroll-mt-20">
            <h2 class="text-2xl md:text-3xl font-bold text-teal-700 mb-2">Ph·∫ßn 5: Kho T√†i nguy√™n V√†ng</h2>
            <p class="text-stone-600 mb-8">Vi·ªác l·ª±a ch·ªçn t√†i li·ªáu ph√π h·ª£p s·∫Ω gi√∫p qu√° tr√¨nh h·ªçc th√∫ v·ªã h∆°n. D∆∞·ªõi ƒë√¢y l√† danh s√°ch c√°c t√†i nguy√™n ch·∫•t l∆∞·ª£ng cao ƒë∆∞·ª£c tuy·ªÉn ch·ªçn ƒë·ªÉ h·ªó tr·ª£ b·∫°n tr√™n h√†nh tr√¨nh chinh ph·ª•c ti·∫øng Anh.</p>
            <div id="resources-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
        </section>
    </main>

    <footer class="bg-white mt-16 border-t border-stone-200">
        <div class="container mx-auto py-6 px-4 text-center text-stone-500">
            <p>&copy; 2025 L·ªô tr√¨nh T∆∞∆°ng t√°c H·ªçc Ti·∫øng Anh. Chuy·ªÉn th·ªÉ t·ª´ b√°o c√°o chi ti·∫øt.</p>
            <p class="text-sm mt-1">ƒê∆∞·ª£c t·∫°o ra ƒë·ªÉ gi√∫p b·∫°n giao ti·∫øp t·ª± tin v√† hi·ªáu qu·∫£.</p>
        </div>
    </footer>
    
    <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[100] hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="modal-title" class="text-lg font-bold text-teal-800">Ph·∫£n h·ªìi t·ª´ AI</h3>
                <button id="modal-close-btn" class="text-stone-500 hover:text-stone-800">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <div class="flex justify-center items-center h-32">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const data = {
                tenses: [
                    { title: "Hi·ªán t·∫°i ƒê∆°n (Present Simple)", content: "<b>Ch·ª©c nƒÉng:</b> Di·ªÖn t·∫£ th√≥i quen, s·ª± th·∫≠t hi·ªÉn nhi√™n, l·ªãch tr√¨nh.<br><b>C√¥ng th·ª©c:</b> S + V(s/es)<br><b>V√≠ d·ª•:</b> <i>She works in an office.</i>" },
                    { title: "Qu√° kh·ª© ƒê∆°n (Past Simple)", content: "<b>Ch·ª©c nƒÉng:</b> K·ªÉ l·∫°i m·ªôt s·ª± ki·ªán ƒë√£ k·∫øt th√∫c trong qu√° kh·ª©.<br><b>C√¥ng th·ª©c:</b> S + V2/ed<br><b>V√≠ d·ª•:</b> <i>I visited my grandparents last weekend.</i>" },
                    { title: "T∆∞∆°ng lai ƒê∆°n (Future Simple)", content: "<b>Ch·ª©c nƒÉng:</b> Di·ªÖn t·∫£ quy·∫øt ƒë·ªãnh t·ª©c th·ªùi, d·ª± ƒëo√°n, l·ªùi h·ª©a.<br><b>C√¥ng th·ª©c:</b> S + will + V<br><b>V√≠ d·ª•:</b> <i>I think it will rain tomorrow.</i>" },
                    { title: "Hi·ªán t·∫°i Ti·∫øp di·ªÖn (Present Continuous)", content: "<b>Ch·ª©c nƒÉng:</b> Di·ªÖn t·∫£ h√†nh ƒë·ªông ƒëang x·∫£y ra ho·∫∑c k·∫ø ho·∫°ch t∆∞∆°ng lai g·∫ßn.<br><b>C√¥ng th·ª©c:</b> S + am/is/are + V-ing<br><b>V√≠ d·ª•:</b> <i>I am preparing for my presentation.</i>" },
                    { title: "Hi·ªán t·∫°i Ho√†n th√†nh (Present Perfect)", content: "<b>Ch·ª©c nƒÉng:</b> Di·ªÖn t·∫£ kinh nghi·ªám, tr·∫£i nghi·ªám; h√†nh ƒë·ªông c√≥ k·∫øt n·ªëi qu√° kh·ª© v√† hi·ªán t·∫°i.<br><b>C√¥ng th·ª©c:</b> S + have/has + V3/ed<br><b>V√≠ d·ª•:</b> <i>I have been to Paris twice.</i>" }
                ],
                modals: [
                    { title: "Di·ªÖn t·∫£ Kh·∫£ nƒÉng (Ability)", content: "<b>can:</b> I can speak English.<br><b>could:</b> I could run fast when I was young.<br><b>be able to:</b> I was able to finish the test." },
                    { title: "ƒê∆∞a ra L·ªùi khuy√™n (Advice)", content: "<b>should:</b> You should get some rest.<br><b>ought to:</b> You ought to apologize.<br><b>had better:</b> You'd better hurry." },
                    { title: "Di·ªÖn t·∫£ S·ª± b·∫Øt bu·ªôc (Obligation)", content: "<b>must:</b> I must finish this report.<br><b>have to:</b> You have to drive on the left.<br><b>mustn't:</b> You mustn't smoke here.<br><b>don't have to:</b> You don't have to wear a tie." },
                    { title: "Xin ph√©p & ƒê·ªÅ ngh·ªã (Permission & Requests)", content: "<b>can:</b> Can I use your pen?<br><b>could:</b> Could I ask a question?<br><b>may:</b> May I come in?"},
                    { title: "ƒê∆∞a ra Suy ƒëo√°n (Deduction/Possibility)", content: "<b>may/might/could:</b> It might rain later.<br><b>must:</b> The lights are on. They must be at home."}
                ],
                prepositions: {
                    time: {
                        title: "Kim t·ª± th√°p Th·ªùi gian",
                        IN: "<b>IN (L·ªõn nh·∫•t):</b> Th·∫ø k·ª∑, Th·∫≠p k·ª∑, NƒÉm, M√πa, Th√°ng. <br><i>in 2024, in August, in the morning</i>",
                        ON: "<b>ON (C·ª• th·ªÉ h∆°n):</b> Ng√†y trong tu·∫ßn, Ng√†y th√°ng. <br><i>on Monday, on June 15th</i>",
                        AT: "<b>AT (Ch√≠nh x√°c nh·∫•t):</b> Gi·ªù c·ª• th·ªÉ, Kho·∫£nh kh·∫Øc. <br><i>at 7 PM, at night</i>"
                    },
                    place: {
                        title: "Kim t·ª± th√°p N∆°i ch·ªën",
                        IN: "<b>IN (Kh√¥ng gian 3D):</b> Qu·ªëc gia, Th√†nh ph·ªë, Ph√≤ng. <br><i>in Vietnam, in a room</i>",
                        ON: "<b>ON (B·ªÅ m·∫∑t 2D):</b> ƒê∆∞·ªùng, S√†n nh√†, B√†n. <br><i>on the table, on Le Loi street</i>",
                        AT: "<b>AT (ƒêi·ªÉm c·ª• th·ªÉ):</b> ƒê·ªãa ch·ªâ, B·∫øn xe bu√Ωt, Tr∆∞·ªùng h·ªçc. <br><i>at the bus stop, at 75 Ho Tung Mau street</i>"
                    }
                },
                vocabulary: {
                    "Ch√†o h·ªèi & Gi·ªõi thi·ªáu": [
                        { word: "Hello", ipa: "/h…ôÀàl…ô ä/", meaning: "Xin ch√†o" },
                        { word: "My name is...", ipa: "/ma…™ ne…™m …™z/", meaning: "T√™n t√¥i l√†..." },
                        { word: "Nice to meet you", ipa: "/na…™s tuÀê miÀêt juÀê/", meaning: "R·∫•t vui ƒë∆∞·ª£c g·∫∑p b·∫°n" },
                        { word: "Thank you", ipa: "/Œ∏√¶≈ãk juÀê/", meaning: "C·∫£m ∆°n b·∫°n" },
                        { word: "Sorry", ipa: "/Ààs…íri/", meaning: "Xin l·ªói" },
                    ],
                    "C√¥ng vi·ªác & VƒÉn ph√≤ng": [
                        { word: "Office", ipa: "/Àà…íf…™s/", meaning: "VƒÉn ph√≤ng" },
                        { word: "Colleague", ipa: "/Ààk…íliÀê…°/", meaning: "ƒê·ªìng nghi·ªáp" },
                        { word: "Meeting", ipa: "/ÀàmiÀêt…™≈ã/", meaning: "Cu·ªôc h·ªçp" },
                        { word: "Deadline", ipa: "/Ààd…õdla…™n/", meaning: "H·∫°n ch√≥t" },
                        { word: "Project", ipa: "/Ààpr…íd í…õkt/", meaning: "D·ª± √°n" },
                    ],
                    "ƒÇn u·ªëng & Nh√† h√†ng": [
                        { word: "Restaurant", ipa: "/Ààrestr…ínt/", meaning: "Nh√† h√†ng" },
                        { word: "Menu", ipa: "/Ààm…õnjuÀê/", meaning: "Th·ª±c ƒë∆°n" },
                        { word: "Order", ipa: "/Àà…îÀêd…ô/", meaning: "G·ªçi m√≥n" },
                        { word: "Dish", ipa: "/d…™ É/", meaning: "M√≥n ƒÉn" },
                        { word: "Bill", ipa: "/b…™l/", meaning: "H√≥a ƒë∆°n" },
                    ],
                    "Du l·ªãch & Ch·ªâ ƒë∆∞·ªùng": [
                        { word: "Travel", ipa: "/Ààtr√¶vl/", meaning: "Du l·ªãch" },
                        { word: "Hotel", ipa: "/h…ô äÀàtel/", meaning: "Kh√°ch s·∫°n" },
                        { word: "Airport", ipa: "/Ààe…ôp…îÀêt/", meaning: "S√¢n bay" },
                        { word: "Ticket", ipa: "/Ààt…™k…™t/", meaning: "V√©" },
                        { word: "Map", ipa: "/m√¶p/", meaning: "B·∫£n ƒë·ªì" },
                    ],
                },
                practice: {
                    requests: {
                        title: "ƒê∆∞a ra Y√™u c·∫ßu & ƒê·ªÅ ngh·ªã",
                        items: [
                            { category: "Y√™u c·∫ßu (Making a request)", phrases: ["<b>Can you...?:</b> Can you pass the salt, please?", "<b>Could you...?:</b> Could you open the window, please?", "<b>Would you mind + V-ing?:</b> Would you mind helping me?"] },
                            { category: "ƒê·ªÅ ngh·ªã (Making a suggestion)", phrases: ["<b>Let's...:</b> Let's go to the cinema.", "<b>How about + V-ing?:</b> How about having pizza?", "<b>Why don't we...?:</b> Why don't we visit the museum?"] }
                        ]
                    },
                    advice: {
                        title: "Cho L·ªùi khuy√™n & G·ª£i √Ω",
                        items: [
                            { category: "C·∫•u tr√∫c khuy√™n", phrases: ["<b>You should...:</b> You should talk to your boss.", "<b>If I were you, I would...:</b> If I were you, I would accept the offer.", "<b>I suggest + V-ing:</b> I suggest taking a short break."] },
                            { category: "C√°ch xin l·ªùi khuy√™n", phrases: ["What should I do?", "What do you think I should do?", "Can you give me some advice?"] }
                        ]
                    },
                    opinions: {
                        title: "B√†y t·ªè Quan ƒëi·ªÉm",
                        items: [
                             { category: "ƒê·ªìng √Ω", phrases: ["I agree.", "I completely agree.", "That's so true.", "I couldn't agree more."] },
                             { category: "Kh√¥ng ƒë·ªìng √Ω (l·ªãch s·ª±)", phrases: ["I'm sorry, but I disagree.", "I'm afraid I can't agree with you.", "I see it differently.", "I'm not so sure about that."] },
                             { category: "ƒê·ªìng √Ω m·ªôt ph·∫ßn", phrases: ["I agree up to a point, but...", "I see your point, but..."] }
                        ]
                    }
                },
                 roadmap: [
                    {
                        phase: "Giai ƒëo·∫°n 1: X√¢y d·ª±ng N·ªÅn t·∫£ng (Tu·∫ßn 1-4)",
                        weeks: [
                            { week: "Tu·∫ßn 1", focus: "Ph√°t √¢m IPA, Th√¨ Hi·ªán t·∫°i ƒê∆°n, T·ª´ v·ª±ng Ch√†o h·ªèi/Gi·ªõi thi·ªáu." },
                            { week: "Tu·∫ßn 2", focus: "N·ªëi √¢m, Th√¨ Qu√° kh·ª© ƒê∆°n, T·ª´ v·ª±ng Gia ƒë√¨nh/Ho·∫°t ƒë·ªông h√†ng ng√†y." },
                            { week: "Tu·∫ßn 3", focus: "Ng·ªØ ƒëi·ªáu, Th√¨ T∆∞∆°ng lai ƒê∆°n & HTTD, T·ª´ v·ª±ng Th·ªùi ti·∫øt/Qu·∫ßn √°o." },
                            { week: "Tu·∫ßn 4", focus: "Tr·ªçng √¢m, Th√¨ Hi·ªán t·∫°i Ho√†n th√†nh, T·ª´ v·ª±ng ƒÇn u·ªëng/Nh√† h√†ng." }
                        ]
                    },
                    {
                        phase: "Giai ƒëo·∫°n 2: M·ªü r·ªông v√† K·∫øt n·ªëi (Tu·∫ßn 5-8)",
                        weeks: [
                            { week: "Tu·∫ßn 5", focus: "Modal verbs (can, could, should), T·ª´ v·ª±ng C√¥ng vi·ªác." },
                            { week: "Tu·∫ßn 6", focus: "Modal verbs (must, have to, may), T·ª´ v·ª±ng Du l·ªãch." },
                            { week: "Tu·∫ßn 7", focus: "Gi·ªõi t·ª´ IN, ON, AT, M·∫´u c√¢u Y√™u c·∫ßu/ƒê·ªÅ ngh·ªã." },
                            { week: "Tu·∫ßn 8", focus: "C·∫•u tr√∫c c√¢u ph·ª©c, M·∫´u c√¢u L·ªùi khuy√™n, T·ª´ v·ª±ng Mi√™u t·∫£ ng∆∞·ªùi." }
                        ]
                    },
                    {
                        phase: "Giai ƒëo·∫°n 3: K√≠ch ho·∫°t v√† T·ª± ƒë·ªông h√≥a (Tu·∫ßn 9-12)",
                        weeks: [
                            { week: "Tu·∫ßn 9", focus: "M·∫´u c√¢u B√†y t·ªè quan ƒëi·ªÉm (ƒê·ªìng √Ω), B·∫Øt ƒë·∫ßu Shadowing." },
                            { week: "Tu·∫ßn 10", focus: "M·∫´u c√¢u (Kh√¥ng ƒë·ªìng √Ω), TƒÉng ƒë·ªô kh√≥ Shadowing." },
                            { week: "Tu·∫ßn 11", focus: "T·∫≠p 'Suy nghƒ© b·∫±ng ti·∫øng Anh', Ghi √¢m v√† ph√¢n t√≠ch." },
                            { week: "Tu·∫ßn 12", focus: "T·ªïng √¥n t·∫≠p, Th·ª≠ th√°ch n√≥i 2-3 ph√∫t, Giao ti·∫øp th·ª±c t·∫ø." }
                        ]
                    }
                ],
                techniques: [
                    { title: "Ph∆∞∆°ng ph√°p Shadowing (N√≥i nh·∫°i)", content: "L√† k·ªπ thu·∫≠t l·∫∑p l·∫°i g·∫ßn nh∆∞ ƒë·ªìng th·ªùi m·ªôt ƒëo·∫°n audio c·ªßa ng∆∞·ªùi b·∫£n x·ª©. <br><b>L·ª£i √≠ch:</b> C·∫£i thi·ªán ph√°t √¢m, ng·ªØ ƒëi·ªáu, ph√° v·ª° th√≥i quen d·ªãch th·∫ßm v√† tƒÉng t·ª± tin. <br><b>C√°c b∆∞·ªõc:</b> 1. Ch·ªçn t√†i li·ªáu ph√π h·ª£p (ng·∫Øn, c√≥ transcript). 2. Nghe v√† ƒë·ªçc theo transcript. 3. B·∫Øt ƒë·∫ßu n√≥i nh·∫°i, b·∫Øt ch∆∞·ªõc m·ªçi th·ª©. 4. Ghi √¢m v√† so s√°nh." },
                    { title: "T·∫≠p Suy nghƒ© b·∫±ng Ti·∫øng Anh", content: "L√† k·ªπ nƒÉng li√™n k·∫øt tr·ª±c ti·∫øp √Ω t∆∞·ªüng v·ªõi ng√¥n ng·ªØ ti·∫øng Anh, kh√¥ng qua b∆∞·ªõc d·ªãch. <br><b>C√°ch l√†m:</b> B·∫Øt ƒë·∫ßu b·∫±ng vi·ªác g·ªçi t√™n ƒë·ªì v·∫≠t xung quanh, sau ƒë√≥ t·∫°o c√¢u ƒë∆°n v·ªÅ h√†nh ƒë·ªông ƒëang l√†m, v√† d·∫ßn d·∫ßn ƒë·ªôc tho·∫°i n·ªôi t√¢m b·∫±ng ti·∫øng Anh." },
                    { title: "H·ªçc theo C·ª•m t·ª´ (Learn in Chunks)", content: "Ng√¥n ng·ªØ t·ª± nhi√™n ƒë∆∞·ª£c t·∫°o th√†nh t·ª´ c√°c c·ª•m t·ª´ (collocations), kh√¥ng ph·∫£i t·ª´ ƒë∆°n l·∫ª. <br><b>V√≠ d·ª•:</b> Thay v√¨ h·ªçc 'decision', h√£y h·ªçc 'make a decision'. ƒêi·ªÅu n√†y gi√∫p c√¢u n√≥i t·ª± nhi√™n v√† tr√¥i ch·∫£y h∆°n." }
                ],
                resources: [
                    { type: 'youtube', title: 'BBC Learning English', desc: 'K√™nh uy t√≠n h√†ng ƒë·∫ßu, b√†i h·ªçc ph√¢n c·∫•p r√µ r√†ng, gi·ªçng ƒë·ªçc chu·∫©n.' },
                    { type: 'youtube', title: 'Learn English with TV Series', desc: 'H·ªçc t·ª´ v·ª±ng v√† c√°ch di·ªÖn ƒë·∫°t qua c√°c ƒëo·∫°n phim n·ªïi ti·∫øng, r·∫•t th√∫ v·ªã.' },
                    { type: 'youtube', title: 'H·ªçc Ti·∫øng Anh Langmaster', desc: 'K√™nh h·ªØu √≠ch cho ng∆∞·ªùi Vi·ªát, c√≥ gi·∫£i th√≠ch b·∫±ng ti·∫øng Vi·ªát, d·ªÖ ti·∫øp c·∫≠n.' },
                    { type: 'podcast', title: '6 Minute English (BBC)', desc: 'M·ªói t·∫≠p d√†i 6 ph√∫t, th·∫£o lu·∫≠n v·ªÅ ch·ªß ƒë·ªÅ th√∫ v·ªã, c√≥ transcript.' },
                    { type: 'podcast', title: 'Easy Stories in English', desc: 'C√°c c√¢u chuy·ªán ng·∫Øn v·ªõi gi·ªçng ƒë·ªçc r·∫•t ch·∫≠m, r√µ r√†ng, ph√π h·ª£p cho ng∆∞·ªùi m·ªõi.' },
                    { type: 'book', title: 'English Grammar in Use', desc: 'S√°ch "kinh ƒëi·ªÉn" v·ªÅ ng·ªØ ph√°p, gi·∫£i th√≠ch r√µ r√†ng v√† c√≥ b√†i t·∫≠p ƒëi k√®m.' },
                    { type: 'book', title: 'Tactics for Listening', desc: 'B·ªô s√°ch luy·ªán nghe c√≥ h·ªá th·ªëng theo 3 c·∫•p ƒë·ªô, t·∫≠p trung v√†o giao ti·∫øp h√†ng ng√†y.' },
                ]
            };

            const API_KEY = "AIzaSyD6lmmWBmnDDRdEQWK2Cx5xqLsUjjjiKMs"; // Intentionally left blank as per instructions

            const callGemini = async (prompt, elementToUpdate, setLoading) => {
                setLoading(true);
                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;
                
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                         throw new Error(`API call failed with status: ${response.status}`);
                    }

                    const result = await response.json();
                   
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        elementToUpdate.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    } else {
                        throw new Error('Invalid response structure from API.');
                    }
                } catch (error) {
                    console.error("Gemini API call error:", error);
                    elementToUpdate.innerHTML = `<p class="text-red-500">R·∫•t ti·∫øc, ƒë√£ c√≥ l·ªói x·∫£y ra khi k·∫øt n·ªëi v·ªõi AI. Vui l√≤ng th·ª≠ l·∫°i sau.</p>`;
                } finally {
                    setLoading(false);
                }
            };
            
            const createAccordionItem = (id, title, content, parentId) => {
                const buttonId = `accordion-button-${id}`;
                const contentId = `accordion-content-${id}`;
                return `
                    <div class="border border-stone-200 rounded-md">
                        <h2>
                            <button type="button" id="${buttonId}" aria-expanded="false" aria-controls="${contentId}" class="accordion-button flex items-center justify-between w-full p-4 font-medium text-left text-stone-700 bg-stone-100 hover:bg-teal-50 transition">
                                <span>${title}</span>
                                <svg class="accordion-arrow w-4 h-4 shrink-0 transition-transform duration-200" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                            </button>
                        </h2>
                        <div id="${contentId}" class="accordion-content" aria-labelledby="${buttonId}">
                            <div class="p-4 border-t border-stone-200 bg-white text-sm text-stone-600">
                                ${content}
                            </div>
                        </div>
                    </div>
                `;
            };

            const setupAccordion = (containerId) => {
                const container = document.getElementById(containerId);
                if(container) {
                    container.addEventListener('click', e => {
                        const button = e.target.closest('.accordion-button');
                        if (button) {
                            const content = document.getElementById(button.getAttribute('aria-controls'));
                            const isExpanded = button.getAttribute('aria-expanded') === 'true';

                            const allButtons = container.querySelectorAll('.accordion-button');
                            allButtons.forEach(b => {
                                if (b !== button) {
                                    b.setAttribute('aria-expanded', 'false');
                                    b.classList.remove('open');
                                    const otherContent = document.getElementById(b.getAttribute('aria-controls'));
                                    if(otherContent) otherContent.style.maxHeight = null;
                                }
                            });
                            
                            button.setAttribute('aria-expanded', !isExpanded);
                            button.classList.toggle('open');
                            content.style.maxHeight = !isExpanded ? content.scrollHeight + 'px' : null;
                        }
                    });
                }
            };
            
            const tensesAccordion = document.getElementById('tenses-accordion');
            if (tensesAccordion) {
                tensesAccordion.innerHTML = data.tenses.map((item, index) => createAccordionItem(`tense-${index}`, item.title, item.content, 'tenses-accordion')).join('');
                setupAccordion('tenses-accordion');
            }

            const modalsAccordion = document.getElementById('modals-accordion');
            if (modalsAccordion) {
                modalsAccordion.innerHTML = data.modals.map((item, index) => createAccordionItem(`modal-${index}`, item.title, item.content, 'modals-accordion')).join('');
                setupAccordion('modals-accordion');
            }

            const techniquesAccordion = document.getElementById('techniques-accordion');
            if (techniquesAccordion) {
                techniquesAccordion.innerHTML = data.techniques.map((item, index) => createAccordionItem(`tech-${index}`, item.title, item.content, 'techniques-accordion')).join('');
                setupAccordion('techniques-accordion');
            }
            
            const createPyramid = (pyramidData, containerId) => {
                const container = document.getElementById(containerId);
                if(container) {
                    container.innerHTML = `
                        <div class="text-center">
                            <h4 class="font-bold text-lg mb-2 text-teal-700">${pyramidData.title}</h4>
                            <div class="space-y-1">
                                <div class="pyramid-level bg-teal-600 rounded-t-md" style="width: 100%;">IN</div>
                                <div class="pyramid-level bg-teal-500" style="width: 80%;">ON</div>
                                <div class="pyramid-level bg-teal-400 rounded-b-md" style="width: 60%;">AT</div>
                            </div>
                             <div class="mt-4 text-left p-3 bg-stone-50 rounded-lg border text-sm text-stone-600 space-y-2">
                                <p>${pyramidData.IN}</p>
                                <p>${pyramidData.ON}</p>
                                <p>${pyramidData.AT}</p>
                            </div>
                        </div>`;
                }
            };

            const timePyramidContainer = document.getElementById('time-pyramid');
            if(timePyramidContainer) createPyramid(data.prepositions.time, 'time-pyramid');
            const placePyramidContainer = document.getElementById('place-pyramid');
            if(placePyramidContainer) createPyramid(data.prepositions.place, 'place-pyramid');

            const vocabThemeSelector = document.getElementById('vocab-theme-selector');
            const vocabDisplay = document.getElementById('vocab-display');
            if (vocabThemeSelector && vocabDisplay) {
                const themes = Object.keys(data.vocabulary);
                themes.forEach(theme => {
                    const option = document.createElement('option');
                    option.value = theme;
                    option.textContent = theme;
                    vocabThemeSelector.appendChild(option);
                });

                const displayVocabByTheme = (theme) => {
                    const words = data.vocabulary[theme];
                    vocabDisplay.innerHTML = words.map(word => `
                        <div class="bg-teal-50 p-3 rounded-lg border border-teal-100 flex flex-col justify-between">
                            <div>
                                <p class="font-bold text-teal-800">${word.word}</p>
                                <p class="text-sm text-teal-600">${word.ipa}</p>
                                <p class="text-sm text-stone-700 mt-1">${word.meaning}</p>
                            </div>
                            <button class="get-example-btn mt-3 text-sm bg-white border border-teal-200 text-teal-700 font-semibold py-1 px-2 rounded-md hover:bg-teal-100 transition" data-word="${word.word}">‚ú® V√≠ d·ª•</button>
                        </div>
                    `).join('');
                };

                vocabThemeSelector.addEventListener('change', (e) => {
                    displayVocabByTheme(e.target.value);
                });

                displayVocabByTheme(themes[0]);
            }
            
            const renderPracticeContent = (practiceData, containerId) => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <div class="space-y-6">
                            ${practiceData.items.map(item => `
                                <div>
                                    <h4 class="font-semibold text-teal-700 mb-2">${item.category}</h4>
                                    <ul class="list-none space-y-2">
                                        ${item.phrases.map(phrase => `<li class="p-3 bg-stone-50 rounded-md border border-stone-200 text-sm text-stone-700">${phrase}</li>`).join('')}
                                    </ul>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            };
            
            renderPracticeContent(data.practice.requests, 'requests-content');
            renderPracticeContent(data.practice.advice, 'advice-content');
            renderPracticeContent(data.practice.opinions, 'opinions-content');

            const roadmapAccordion = document.getElementById('roadmap-accordion');
            if (roadmapAccordion) {
                roadmapAccordion.innerHTML = data.roadmap.map((phase, phaseIndex) => `
                    <div class="border border-stone-200 rounded-md">
                        <h3 class="p-4 bg-stone-100 font-bold text-teal-800">${phase.phase}</h3>
                        <div class="p-2 space-y-2">
                            ${phase.weeks.map((week, weekIndex) => createAccordionItem(`roadmap-${phaseIndex}-${weekIndex}`, week.week, `<b>Tr·ªçng t√¢m:</b> ${week.focus}`, `roadmap-accordion`)).join('')}
                        </div>
                    </div>
                `).join('');
                setupAccordion('roadmap-accordion');
            }
            
             const resourcesContainer = document.getElementById('resources-container');
            if (resourcesContainer) {
                const icons = {
                    youtube: `<svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.73,18.78 17.93,18.84C17.13,18.91 16.44,18.94 15.84,18.94L15,19C12.81,19 11.2,18.84 10.17,18.56C9.27,18.31 8.69,17.73 8.44,16.83C8.16,15.8 8,14.19 8,12L8.06,11.16C8.06,10.56 8.09,9.87 8.16,9.07C8.22,8.27 8.31,7.64 8.44,7.17C8.69,6.27 9.27,5.69 10.17,5.44C11.2,5.16 12.81,5 15,5L15.84,5.06C16.44,5.06 17.13,5.09 17.93,5.16C18.73,5.22 19.36,5.31 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z" /></svg>`,
                    podcast: `<svg class="w-6 h-6 text-purple-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12C20,15.09 18.23,17.67 15.65,18.96L12,14.31L8.35,18.96C5.77,17.67 4,15.09 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12C6,14.28 7.35,16.19 9.3,17.22L12,14.5L14.7,17.22C16.65,16.19 18,14.28 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z" /></svg>`,
                    book: `<svg class="w-6 h-6 text-sky-500" fill="currentColor" viewBox="0 0 24 24"><path d="M18,22A2,2 0 0,0 20,20V4C20,2.89 19.1,2 18,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18M11,4H13V16L11,14.5L9,16V4H11Z" /></svg>`
                };
                resourcesContainer.innerHTML = data.resources.map(res => `
                    <div class="bg-white p-4 rounded-lg shadow-sm flex items-start space-x-4 transition hover:shadow-md">
                        <div>${icons[res.type] || icons['book']}</div>
                        <div>
                            <h4 class="font-bold text-stone-800">${res.title}</h4>
                            <p class="text-sm text-stone-600">${res.desc}</p>
                        </div>
                    </div>
                `).join('');
            }
            
            const ctx = document.getElementById('tensesChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['HT Ho√†n th√†nh', 'HT ƒê∆°n', 'QK ƒê∆°n', 'TL ƒê∆°n', 'HT Ti·∫øp di·ªÖn', 'Kh√°c'],
                        datasets: [{
                            label: 'T·∫ßn su·∫•t s·ª≠ d·ª•ng',
                            data: [60, 15, 10, 5, 5, 5],
                            backgroundColor: ['#0d9488', '#14b8a6', '#5eead4', '#99f6e4', '#ccfbf1', '#f0f0f0'],
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    boxWidth: 12,
                                    font: {
                                        family: "'Be Vietnam Pro', sans-serif"
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            const tabHandler = (containerId) => {
                 const container = document.getElementById(containerId);
                 if (!container) return;
                 const tabButtons = container.querySelectorAll('.tab-button');
                 const tabContents = container.querySelectorAll('.tab-content');

                 tabButtons.forEach(button => {
                     button.addEventListener('click', () => {
                         tabButtons.forEach(btn => btn.classList.remove('active'));
                         button.classList.add('active');
                         const tabName = button.dataset.tab;
                         tabContents.forEach(content => {
                             if (content.id === `${tabName}-content`) {
                                 content.classList.remove('hidden');
                             } else {
                                 content.classList.add('hidden');
                             }
                         });
                     });
                 });
            };

            tabHandler('grammar-tabs-container');
            tabHandler('practice-tabs-container');
            
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
                 document.querySelectorAll('#mobile-menu a').forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenu.classList.add('hidden');
                    });
                });
            }

            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section[id]');
            
            const activateNavLink = () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 100) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            };
            window.addEventListener('scroll', activateNavLink);
            
            const modal = document.getElementById('ai-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            
            const showModal = (title, content) => {
                modalTitle.textContent = title;
                modalBody.innerHTML = content;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            };
            
            const hideModal = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                modalBody.innerHTML = '';
            };
            
            if (modalCloseBtn) {
                 modalCloseBtn.addEventListener('click', hideModal);
            }
            if(modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        hideModal();
                    }
                });
            }

            const loadingSpinner = `<div class="flex justify-center items-center h-32"><div class="spinner"></div></div>`;

            vocabDisplay.addEventListener('click', (e) => {
                if (e.target.classList.contains('get-example-btn')) {
                    e.target.disabled = true;
                    const word = e.target.dataset.word;
                    showModal(`V√≠ d·ª• cho t·ª´ "${word}"`, loadingSpinner);
                    const prompt = `You are an English teacher. For the English word "${word}", please provide three clear example sentences. For each sentence, also provide the Vietnamese translation. The examples should be suitable for an intermediate English learner. Format the response as an HTML unordered list (<ul>).`;
                    callGemini(prompt, modalBody, ()=>{});
                    e.target.disabled = false;
                }
            });

            const generateScenarioBtn = document.getElementById('generate-scenario-btn');
            const scenarioDisplay = document.getElementById('scenario-display');
            const userResponseInput = document.getElementById('user-response-input');
            const getFeedbackBtn = document.getElementById('get-feedback-btn');
            const feedbackDisplay = document.getElementById('feedback-display');

            if(generateScenarioBtn) {
                generateScenarioBtn.addEventListener('click', () => {
                    const prompt = `Create a short, common, real-life English communication scenario for an intermediate learner. The scenario should require the user to respond. The scenario should be presented in English. Just provide the scenario, no extra text.`;
                    callGemini(prompt, scenarioDisplay, (isLoading) => {
                        generateScenarioBtn.disabled = isLoading;
                        generateScenarioBtn.innerHTML = isLoading ? '<div class="spinner !w-5 !h-5 !border-2 !border-left-white"></div> ƒêang t·∫°o...' : '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v1.126a9.002 9.002 0 015.122 5.122H18a1 1 0 01.954.88l.035.116a1 1 0 01-1.88.168L17 10h-1.126a9.002 9.002 0 01-5.122-5.122V4a1 1 0 01-.88-.954L9.842 3A1 1 0 0111.17 1.76l.13.016zM10 4.874A6.002 6.002 0 004.874 10H4a1 1 0 100 2h.874A6.002 6.002 0 0010 17.126V18a1 1 0 102 0v-.874A6.002 6.002 0 0017.126 12H18a1 1 0 100-2h-.874A6.002 6.002 0 0012 4.874L11.874 5H12a5 5 0 015 5v.126A6.002 6.002 0 0012.126 15H12a5 5 0 01-5-5v-.126A6.002 6.002 0 0011.874 5H12v-.126z" clip-rule="evenodd" /></svg> T·∫°o t√¨nh hu·ªëng m·ªõi';
                    });
                    feedbackDisplay.classList.add('hidden');
                    userResponseInput.value = '';
                });
            }

            if(getFeedbackBtn) {
                getFeedbackBtn.addEventListener('click', () => {
                    const scenario = scenarioDisplay.textContent;
                    const userResponse = userResponseInput.value;
                    if (!userResponse.trim()) {
                        alert("Vui l√≤ng nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n.");
                        return;
                    }
                    feedbackDisplay.classList.remove('hidden');
                    feedbackDisplay.innerHTML = loadingSpinner;
                    
                    const prompt = `You are a friendly and helpful English teacher. Your student, a native Vietnamese speaker, was given the following scenario: "${scenario}". The student wrote this response in English: "${userResponse}". Please provide feedback on their response in Vietnamese. Use markdown for formatting. Structure your feedback in three parts: 1. **Nh·∫≠n x√©t chung:** Briefly praise their effort and give an overall impression. 2. **ƒêi·ªÉm c·∫ßn c·∫£i thi·ªán:** Point out any grammar, vocabulary, or politeness issues. Explain clearly and simply why it's a mistake. 3. **G·ª£i √Ω hay h∆°n:** Provide one or two alternative, more natural ways to respond in English, along with their Vietnamese translations.`;

                    callGemini(prompt, feedbackDisplay, (isLoading) => {
                         getFeedbackBtn.disabled = isLoading;
                         getFeedbackBtn.textContent = isLoading ? 'ƒêang ph√¢n t√≠ch...' : '‚ú® Nh·∫≠n ph·∫£n h·ªìi t·ª´ AI';
                    });
                });
            }

            const aiRequestInput = document.getElementById('ai-request-input');
            const generateCustomBtn = document.getElementById('generate-custom-btn');
            const customOutputDisplay = document.getElementById('custom-output-display');

            if (generateCustomBtn) {
                generateCustomBtn.addEventListener('click', () => {
                    const userRequest = aiRequestInput.value;
                    if (!userRequest.trim()) {
                        alert("Vui l√≤ng nh·∫≠p y√™u c·∫ßu c·ªßa b·∫°n.");
                        return;
                    }
                    customOutputDisplay.innerHTML = loadingSpinner;
                    
                    const prompt = `You are a helpful and creative English teacher. A Vietnamese student has the following request: "${userRequest}". 
                    Please fulfill this request by generating the content in English. 
                    After the English content, provide a clear, concise explanation in Vietnamese. 
                    The explanation should focus on key vocabulary, grammar structures, or phrases used. 
                    Format your entire response using markdown for clarity (e.g., using ** for bolding).`;

                    callGemini(prompt, customOutputDisplay, (isLoading) => {
                        generateCustomBtn.disabled = isLoading;
                        generateCustomBtn.innerHTML = isLoading ? '<div class="spinner !w-5 !h-5 !border-2 !border-left-white"></div> ƒêang x·ª≠ l√Ω...' : 'üöÄ T·∫°o n·ªôi dung';
                    });
                });
            }
        });
    </script>
</body>
</html>
